--- ocaml/bytecomp/translcore.ml	2008-08-27 06:23:21.000000000 -0400
+++ translcore.ml	2010-06-21 13:59:21.000000000 -0400
@@ -1,3 +1,15 @@
+(*
+ * This file is part of ocamljs, OCaml to Javascript compiler
+ * Copyright (C) 2007-9 Skydeck, Inc
+ *
+ * This program is free software released under the QPL.
+ * See LICENSE for more details.
+ *
+ * The Software is provided AS IS with NO WARRANTY OF ANY KIND,
+ * INCLUDING THE WARRANTY OF DESIGN, MERCHANTABILITY AND 
+ * FITNESS FOR A PARTICULAR PURPOSE.
+ *)
+
 (***********************************************************************)
 (*                                                                     *)
 (*                           Objective Caml                            *)
@@ -31,6 +43,16 @@
 
 exception Error of Location.t * error
 
+let inline_exp e =
+  let desc = {
+    prim_name = "$inline_exp";
+    prim_arity = 1;
+    prim_alloc = false;
+    prim_native_name = "";
+    prim_native_float = false;
+  } in
+  Lprim (Pccall desc, [ e ])
+
 (* Forward declaration -- to be filled in by Translmod.transl_module *)
 let transl_module =
   ref((fun cc rootpath modl -> assert false) :
@@ -654,6 +676,14 @@
       end
   | Texp_construct(cstr, args) ->
       let ll = transl_list args in
+      if has_base_type e Predef.path_bool
+      then
+        let _loc = Lconst (Const_pointer 0) in (* XXX fix lambda_meta_generator, translate e.exp_loc? *)
+        match cstr.cstr_tag with
+          | Cstr_constant 0 -> inline_exp <:lam_exp< false >>
+          | Cstr_constant 1 -> inline_exp <:lam_exp< true >>
+          | _ -> assert false
+      else
       begin match cstr.cstr_tag with
         Cstr_constant n ->
           Lconst(Const_pointer n)
